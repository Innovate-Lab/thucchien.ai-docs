---
sidebar_position: 3
title: Sinh hình ảnh (với Chat)
description: Tạo hình ảnh trong một cuộc hội thoại bằng cách sử dụng mô hình đa phương thức.
hide_table_of_contents: true
---

import ApiReferenceLayout, { LeftColumn, RightColumn } from '@site/src/components/ApiReferenceLayout';
import InteractiveApiRequest from '@site/src/components/InteractiveApiRequest';
import ApiParameter from '@site/src/components/ApiParameter';
import CodeBlock from '@theme/CodeBlock';
import Badge from '@site/src/components/Badge';

# Sinh hình ảnh (với Chat Completions)

## <Badge method="POST" /> `/chat/completions`

Tạo hình ảnh trong một cuộc hội thoại bằng cách sử dụng mô hình đa phương thức.

<ApiReferenceLayout>
  <LeftColumn>
    ### Cấu trúc yêu cầu (Request Body)

    <ApiParameter name="messages" type="array" required>
      Một danh sách các đối tượng message. Message cuối cùng nên chứa prompt để tạo ảnh.
    </ApiParameter>
    <ApiParameter name="model" type="string" required>
      ID của mô hình đa phương thức sẽ sử dụng. Ví dụ: `gemini-2.5-flash-image-preview`.
    </ApiParameter>
    <ApiParameter name="modalities" type="array" isEnd>
      Chỉ định `["image"]` để yêu cầu trả về dữ liệu hình ảnh.
    </ApiParameter>

    ---

    ### Cấu trúc Phản hồi (Response Body)

    Phản hồi sẽ tương tự như của Chat Completions, nhưng đối tượng `message` sẽ chứa một mảng `images`.

    #### Đối tượng `ImageMessage`
    <ApiParameter name="images" type="array" isEnd>
      Một danh sách các đối tượng hình ảnh được tạo.
    </ApiParameter>

    #### Đối tượng `ImageURL`
    <ApiParameter name="image_url" type="object" isEnd>
       Đối tượng chứa URL dữ liệu base64 của ảnh.
    </ApiParameter>
     <ApiParameter name="url" type="string" isEnd>
       URL dữ liệu base64 của ảnh (ví dụ: `data:image/png;base64,...`).
    </ApiParameter>

  </LeftColumn>
  <RightColumn>
    <InteractiveApiRequest
      apiUrl="https://api.thucchien.ai/chat/completions"
      initialParameters={{
        apiKey: '<your_api_key>',
        model: 'gemini-2.5-flash-image-preview',
        prompt: 'A breathtaking scene where a majestic waterfall cascades down rugged cliffs, shimmering like silver threads under the warm sunlight. Lush greenery surrounds the falls—towering trees, vibrant flowers, and soft moss painting nature’s perfect canvas. Mist rises gently, forming a magical rainbow that arches across the sky, while birds soar gracefully above as if dancing to the music of nature. A dreamlike moment that blends serenity and beauty in one stunning view.',
      }}
      parameterControls={{
        apiKey: { type: 'input' },
        model: { type: 'select', options: ['gemini-2.5-flash-image-preview'] },
        prompt: { type: 'textarea' },
      }}
      codeTemplates={{
        'curl': {
          language: 'bash',
          template: `curl https://api.thucchien.ai/chat/completions \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer {{apiKey}}" \\
  -d '{
    "model": "{{model}}",
    "messages": [
      {
        "role": "user",
        "content": "{{prompt}}"
      }
    ],
    "modalities": ["image"]
  }'`,
        },
        'Python (openai)': {
          language: 'python',
          template: `from openai import OpenAI
import base64

client = OpenAI(
    api_key="{{apiKey}}",
    base_url="https://api.thucchien.ai"
)

response = client.chat.completions.create(
    model="{{model}}",
    messages=[{"role": "user", "content": "{{prompt}}"}],
    modalities=["image"]
)

# Lưu ảnh từ dữ liệu base64
base64_string = response.choices[0].message.images[0].image_url.url
if ',' in base64_string:
    header, encoded = base64_string.split(',', 1)
else:
    encoded = base64_string
image_data = base64.b64decode(encoded)
with open("generated_chat_image.png", "wb") as f:
    f.write(image_data)
print("Image saved to generated_chat_image.png")`,
        },
      }}
      buildBody={(params) => ({
        model: params.model,
        messages: [{ role: 'user', content: params.prompt }],
        modalities: ['image'],
      })}
      exampleResponse={{
        "id": "chatcmpl-mock",
        "object": "chat.completion",
        "created": 1759806089,
        "model": "gemini-2.5-flash-image-preview",
        "choices": [
          {
            "index": 0,
            "message": {
              "role": "assistant",
              "content": null,
              "images": [
                {
                  "image_url": {
                    "url": "data:image/png;base64,<base64_encoded_image_data>"
                  }
                }
              ]
            },
            "finish_reason": "stop"
          }
        ],
        "usage": {
          "prompt_tokens": 15,
          "completion_tokens": 1,
          "total_tokens": 16
        }
      }}
    />
  </RightColumn>
</ApiReferenceLayout>


## <Badge method="POST" /> `/gemini/v1beta/models/gemini-2.5-flash-image-preview:generateContent`

Tạo hình ảnh với endpoint pass through tới Google Gemini.

:::info[Tham khảo]
Chi tiết đầy đủ các tham số, tham khảo [tài liệu Google Gemini](https://ai.google.dev/gemini-api/docs/image-generation).
:::

<ApiReferenceLayout>
  <LeftColumn>
    ### Cấu trúc yêu cầu (Request Body)

    <ApiParameter name="contents" type="array" required>
      Nội dung của yêu cầu.
    </ApiParameter>
    <ApiParameter name="parts" type="array" required indent={1}>
      Một danh sách các phần của nội dung. Phần tử đầu tiên nên là prompt văn bản.
    </ApiParameter>
    <ApiParameter name="text" type="string" required indent={2}>
      Prompt văn bản để tạo hình ảnh.
    </ApiParameter>
    <ApiParameter name="inline_data" type="string" indent={2}>
      Dữ liệu hình ảnh dưới dạng base64 (nếu có). Tham khảo cách truyền dữ liệu hình ảnh tại [đây](https://ai.google.dev/gemini-api/docs/image-generation#gemini-image-editing).
    </ApiParameter>
    <ApiParameter name="mime_type" type="string" indent={4}>
      Loại MIME của hình ảnh, ví dụ: `image/png`, `image/jpeg`.
    </ApiParameter>
    <ApiParameter name="data" type="string" indent={4}>
      Dữ liệu hình ảnh dưới dạng base64.
    </ApiParameter>

    <ApiParameter name="generationConfig" type="object">
      Cấu hình cho việc sinh nội dung.
    </ApiParameter>
    <ApiParameter name="imageConfig" type="object" indent={1}>
      Cấu hình dành riêng cho việc sinh hình ảnh.
    </ApiParameter>
    <ApiParameter name="aspectRatio" type="string" indent={2}>
      Tỷ lệ khung hình của hình ảnh được tạo. Các giá trị được hỗ trợ:
      - **Landscape:** `21:9`, `16:9`, `4:3`, `3:2`
      - **Square:** `1:1`
      - **Portrait:** `9:16`, `3:4`, `2:3`
      - **Flexible:** `5:4`, `4:5`
    </ApiParameter>
    <ApiParameter name="responseModalities" type="array" isEnd>
      Mô hình mặc định trả về phản hồi văn bản và hình ảnh (tức là `"responseModalities": ['Text', 'Image']`). Bạn có thể cấu hình phản hồi để chỉ trả về hình ảnh mà không có văn bản bằng cách sử dụng `"responseModalities": ['Image']`.
    </ApiParameter>

    ---

    ### Cấu trúc Phản hồi (Response Body)

    #### Đối tượng `Candidate`
    <ApiParameter name="candidates" type="array">
      Một danh sách các ứng viên được tạo.
    </ApiParameter>
    <ApiParameter name="content" type="object" indent={1}>
      Nội dung của ứng viên.
    </ApiParameter>
    <ApiParameter name="parts" type="array" indent={2}>
      Một danh sách các phần của nội dung.
    </ApiParameter>
    <ApiParameter name="inlineData" type="object" indent={3}>
      Dữ liệu hình ảnh dưới dạng base64.
    </ApiParameter>
    <ApiParameter name="mime_type" type="string" indent={4}>
      Loại MIME của hình ảnh, ví dụ: `image/png`.
    </ApiParameter>
    <ApiParameter name="data" type="string" indent={4} isEnd>
      Dữ liệu hình ảnh được mã hóa base64.
    </ApiParameter>

  </LeftColumn>
  <RightColumn>
    <InteractiveApiRequest
      apiUrl="https://api.thucchien.ai/gemini/v1beta/models/gemini-2.5-flash-image-preview:generateContent"
      initialParameters={{
        apiKey: '<your_api_key>',
        prompt: 'A photorealistic close-up portrait of an elderly Japanese ceramicist with deep, sun-etched wrinkles and a warm, knowing smile. He is carefully inspecting a freshly glazed tea bowl. The setting is his rustic, sun-drenched workshop with pottery wheels and shelves of clay pots in the background. The scene is illuminated by soft, golden hour light streaming through a window, highlighting the fine texture of the clay and the fabric of his apron. Captured with an 85mm portrait lens, resulting in a soft, blurred background (bokeh). The overall mood is serene and masterful.',
        aspectRatio: '9:16',
      }}
      parameterControls={{
        apiKey: { type: 'input' },
        prompt: { type: 'textarea' },
        aspectRatio: { type: 'select', options: ['21:9', '16:9', '4:3', '3:2', '1:1', '9:16', '3:4', '2:3', '5:4', '4:5'] },
      }}
      codeTemplates={{
        'curl': {
          language: 'bash',
          template: `curl 'https://api.thucchien.ai/gemini/v1beta/models/gemini-2.5-flash-image-preview:generateContent' \\
  -H 'x-goog-api-key: {{apiKey}}' \\
  -H 'Content-Type: application/json' \\
  -d '{
    "contents": [{
      "parts": [
        {"text": "{{prompt}}"}
      ]
    }],
    "generationConfig": {
        "imageConfig": {
            "aspectRatio": "{{aspectRatio}}"
        }
    }
  }'`,
        },
      }}
      buildBody={(params) => ({
        contents: [{
          parts: [
            { text: params.prompt }
          ]
        }],
        generationConfig: {
            imageConfig: {
            aspectRatio: params.aspectRatio
            }
        }
      })}
      exampleResponse={{
        "candidates": [
          {
            "content": {
              "parts": [
                {
                  "inlineData": {
                    "mime_type": "image/png",
                    "data": "<base64_encoded_image_data>"
                  }
                }
              ],
              "role": "model"
            },
            "finishReason": "STOP",
            "index": 0,
            "safetyRatings": [
              { "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "probability": "NEGLIGIBLE" },
              { "category": "HARM_CATEGORY_HATE_SPEECH", "probability": "NEGLIGIBLE" },
              { "category": "HARM_CATEGORY_HARASSMENT", "probability": "NEGLIGIBLE" },
              { "category": "HARM_CATEGORY_DANGEROUS_CONTENT", "probability": "NEGLIGIBLE" }
            ]
          }
        ]
      }}
    />
  </RightColumn>
</ApiReferenceLayout>
